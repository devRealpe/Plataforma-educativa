<div class="podium-container">
  <!-- Header -->
  <div class="podium-header">
    <div class="header-left">
      <h2 class="podium-title">üèÜ Podio de Retos</h2>
      <p class="podium-subtitle">
        {{
          viewMode === "course"
            ? "Top 10 de este curso"
            : "Top 10 del nivel " + courseLevel
        }}
      </p>
    </div>
    <button class="toggle-btn" (click)="toggleViewMode()">
      <svg
        width="20"
        height="20"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        <path d="M9 12l2 2 4-4" />
      </svg>
      {{ viewMode === "course" ? "Ver Nivel Completo" : "Ver Solo Este Curso" }}
    </button>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="loading">
    <div class="spinner"></div>
    <p>Cargando podio...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && podiumEntries.length === 0" class="empty-state">
    <div class="empty-icon">
      <svg
        width="80"
        height="80"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="1.5"
      >
        <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
        <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
        <path d="M4 22h16" />
        <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
        <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
        <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
      </svg>
    </div>
    <h3>No hay retos completados a√∫n</h3>
    <p>S√© el primero en resolver un reto y aparecer en el podio</p>
  </div>

  <!-- Podium List -->
  <div *ngIf="!isLoading && podiumEntries.length > 0" class="podium-list">
    <!-- Top 3 Destacado -->
    <div class="top-three" *ngIf="podiumEntries.length >= 3">
      <!-- 2do Lugar -->
      <div
        class="top-card second"
        [class.my-entry]="isMyEntry(podiumEntries[1])"
      >
        <div class="medal-badge silver">
          <span class="medal-emoji">ü•à</span>
        </div>
        <div class="card-content">
          <div class="student-avatar silver">
            {{ podiumEntries[1].studentName.charAt(0).toUpperCase() }}
          </div>
          <h3 class="student-name">{{ podiumEntries[1].studentName }}</h3>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-value">{{
                podiumEntries[1].totalBonusPoints
              }}</span>
              <span class="stat-label">XP</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{
                podiumEntries[1].challengesCompleted
              }}</span>
              <span class="stat-label">Retos</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 1er Lugar -->
      <div
        class="top-card first"
        [class.my-entry]="isMyEntry(podiumEntries[0])"
      >
        <div class="medal-badge gold">
          <span class="medal-emoji">ü•á</span>
          <div class="crown">üëë</div>
        </div>
        <div class="card-content">
          <div class="student-avatar gold">
            {{ podiumEntries[0].studentName.charAt(0).toUpperCase() }}
          </div>
          <h3 class="student-name">{{ podiumEntries[0].studentName }}</h3>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-value">{{
                podiumEntries[0].totalBonusPoints
              }}</span>
              <span class="stat-label">XP</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{
                podiumEntries[0].challengesCompleted
              }}</span>
              <span class="stat-label">Retos</span>
            </div>
          </div>
        </div>
      </div>

      <!-- 3er Lugar -->
      <div
        class="top-card third"
        [class.my-entry]="isMyEntry(podiumEntries[2])"
      >
        <div class="medal-badge bronze">
          <span class="medal-emoji">ü•â</span>
        </div>
        <div class="card-content">
          <div class="student-avatar bronze">
            {{ podiumEntries[2].studentName.charAt(0).toUpperCase() }}
          </div>
          <h3 class="student-name">{{ podiumEntries[2].studentName }}</h3>
          <div class="stats">
            <div class="stat-item">
              <span class="stat-value">{{
                podiumEntries[2].totalBonusPoints
              }}</span>
              <span class="stat-label">XP</span>
            </div>
            <div class="stat-item">
              <span class="stat-value">{{
                podiumEntries[2].challengesCompleted
              }}</span>
              <span class="stat-label">Retos</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Lista del 4to al 10mo -->
    <div class="ranking-list" *ngIf="podiumEntries.length > 3">
      <div
        *ngFor="let entry of podiumEntries.slice(3)"
        class="ranking-item"
        [class.my-entry]="isMyEntry(entry)"
      >
        <div class="rank-badge" [class]="getMedalClass(entry.position)">
          {{ getMedalEmoji(entry.position) }}
        </div>

        <div class="student-info">
          <div class="student-avatar-small">
            {{ entry.studentName.charAt(0).toUpperCase() }}
          </div>
          <div class="student-details">
            <h4 class="student-name">{{ entry.studentName }}</h4>
            <p class="student-email">{{ entry.studentEmail }}</p>
          </div>
        </div>

        <div class="progress-section">
          <div class="progress-bar">
            <div
              class="progress-fill"
              [style.width.%]="getProgressBarWidth(entry.totalBonusPoints)"
              [style.background]="getProgressBarColor(entry.position)"
            ></div>
          </div>
          <div class="progress-stats">
            <span class="stat">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                />
              </svg>
              {{ entry.totalBonusPoints }} XP
            </span>
            <span class="stat">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path
                  d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"
                />
                <path
                  d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"
                />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
              </svg>
              {{ entry.challengesCompleted }} Retos
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Mi Posici√≥n (si no estoy en el top 10) -->
    <div
      *ngIf="
        !isTeacher &&
        myPosition &&
        myPosition.position &&
        myPosition.position > 10
      "
      class="my-position-card"
    >
      <div class="position-header">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
          <circle cx="12" cy="7" r="4" />
        </svg>
        <span>Tu Posici√≥n</span>
      </div>
      <div class="ranking-item highlighted">
        <div class="rank-badge default">{{ myPosition.position }}¬∫</div>
        <div class="student-info">
          <div class="student-avatar-small">
            {{ myPosition.studentName.charAt(0).toUpperCase() }}
          </div>
          <div class="student-details">
            <h4 class="student-name">{{ myPosition.studentName }}</h4>
            <p class="student-email">{{ myPosition.studentEmail }}</p>
          </div>
        </div>
        <div class="progress-section">
          <div class="progress-stats">
            <span class="stat">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="currentColor"
              >
                <polygon
                  points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"
                />
              </svg>
              {{ myPosition.totalBonusPoints }} XP
            </span>
            <span class="stat">
              <svg
                width="14"
                height="14"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path
                  d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"
                />
                <path
                  d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"
                />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
              </svg>
              {{ myPosition.challengesCompleted }} Retos
            </span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
