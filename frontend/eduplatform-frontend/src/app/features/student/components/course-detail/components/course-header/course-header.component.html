<!-- Wrapper Principal -->
<div class="course-detail-wrapper">
  <!-- Background Gradient -->
  <div class="background-gradient"></div>

  <!-- Header Sticky -->
  <header class="header">
    <div class="header-content">
      <!-- Back Navigation -->
      <button
        class="back-btn"
        (click)="goBack()"
        aria-label="Volver al Dashboard"
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="19" y1="12" x2="5" y2="12"></line>
          <polyline points="12 19 5 12 12 5"></polyline>
        </svg>
        <span>Volver al Dashboard</span>
      </button>

      <!-- Course Header Info -->
      <div class="course-header" *ngIf="course">
        <div class="course-header-main">
          <div class="course-title-section">
            <h1 class="course-title">{{ course.title }}</h1>
            <p class="course-description">{{ course.description }}</p>
          </div>

          <div class="course-meta-badges">
            <div class="meta-badge level">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <polygon points="12 2 2 7 12 12 22 7 12 2"></polygon>
                <polyline points="2 17 12 22 22 17"></polyline>
                <polyline points="2 12 12 17 22 12"></polyline>
              </svg>
              <span>Nivel {{ course.level }}</span>
            </div>
            <div class="meta-badge teacher">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
              </svg>
              <span>{{ course.teacherName }}</span>
            </div>
          </div>
        </div>
      </div>

      <!-- Tab Navigation -->
      <nav class="tabs-navigation" role="tablist">
        <button
          class="tab-btn"
          [class.active]="activeTab === 'exercises'"
          (click)="onTabChange('exercises')"
          role="tab"
          [attr.aria-selected]="activeTab === 'exercises'"
          aria-label="Ver Ejercicios"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            ></path>
            <polyline points="14 2 14 8 20 8"></polyline>
          </svg>
          <span class="tab-label">Ejercicios</span>
          <span class="tab-count">{{ exerciseCount }}</span>
        </button>

        <button
          class="tab-btn"
          [class.active]="activeTab === 'challenges'"
          (click)="onTabChange('challenges')"
          role="tab"
          [attr.aria-selected]="activeTab === 'challenges'"
          aria-label="Ver Retos"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path>
            <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path>
            <path d="M4 22h16"></path>
            <path
              d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"
            ></path>
            <path
              d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"
            ></path>
            <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path>
          </svg>
          <span class="tab-label">Retos</span>
          <span class="tab-count">{{ challengeCount }}</span>
        </button>

        <button
          class="tab-btn"
          [class.active]="activeTab === 'podium'"
          (click)="onTabChange('podium')"
          role="tab"
          [attr.aria-selected]="activeTab === 'podium'"
          aria-label="Ver Podio"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="8" r="7"></circle>
            <polyline
              points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"
            ></polyline>
          </svg>
          <span class="tab-label">Podio</span>
        </button>
      </nav>
    </div>
  </header>

  <!-- ============================================ -->
  <!-- üÜï CONTENIDO DIN√ÅMICO SEG√öN TAB ACTIVO -->
  <!-- ============================================ -->
  <main class="main-content">
    <!-- Tab: Ejercicios -->
    <app-exercise-list
      *ngIf="activeTab === 'exercises'"
      [exercises]="exercises"
      [submissions]="submissions"
      [isLoading]="isLoading"
      (uploadExercise)="openUploadModal($event)"
      (editSubmission)="openEditModal($event.exercise, $event.submission)"
      (deleteSubmission)="deleteSubmission($event)"
      (downloadExercise)="downloadExercise($event)"
      (downloadSubmission)="downloadSubmission($event)"
      (openExternalUrl)="openExternalUrl($event)"
    ></app-exercise-list>

    <!-- Tab: Retos -->
    <app-challenge-list
      *ngIf="activeTab === 'challenges'"
      [challenges]="challenges"
      [submissions]="challengeSubmissions"
      [isLoading]="isLoadingChallenges"
      [courseId]="courseId"
    ></app-challenge-list>

    <!-- Tab: Podio -->
    <app-podium
      *ngIf="activeTab === 'podium' && course"
      [courseId]="courseId"
      [courseLevel]="course.level"
      [isTeacher]="false"
    ></app-podium>
  </main>
</div>

<!-- ============================================ -->
<!-- üÜï MODALES -->
<!-- ============================================ -->

<!-- Modal: Subir/Editar Entrega -->
<div *ngIf="showUploadModal" class="modal-overlay" (click)="closeUploadModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <h3>{{ isEditMode ? "‚úèÔ∏è Editar Entrega" : "üì§ Subir Entrega" }}</h3>
      <button class="close-btn" (click)="closeUploadModal()">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <p class="modal-description">
        <strong>Ejercicio:</strong> {{ selectedExercise?.title }}<br />
        <span *ngIf="isEditMode" class="edit-warning">
          ‚ö†Ô∏è Al editar, se actualizar√° tu entrega actual.
        </span>
        <span *ngIf="!isEditMode">
          üì§ Tu entrega estar√° visible inmediatamente para el profesor.
        </span>
      </p>

      <!-- File Upload -->
      <div class="file-upload-area" *ngIf="!selectedFile">
        <input
          type="file"
          id="submission-file"
          class="file-input"
          (change)="onFileSelected($event)"
          accept=".pdf,.zip,.rar,.doc,.docx,.txt"
        />
        <label for="submission-file" class="file-label">
          <svg
            width="48"
            height="48"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="17 8 12 3 7 8" />
            <line x1="12" y1="3" x2="12" y2="15" />
          </svg>
          <span>Haz clic para seleccionar archivo</span>
          <span class="file-hint">PDF, ZIP, DOC, TXT (m√°x. 10MB)</span>
        </label>
      </div>

      <!-- Selected File -->
      <div *ngIf="selectedFile" class="file-selected">
        <div class="file-info">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"
            />
            <polyline points="13 2 13 9 20 9" />
          </svg>
          <span>{{ selectedFile.name }}</span>
        </div>
        <button class="remove-file-btn" (click)="removeFile()">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <line x1="18" y1="6" x2="6" y2="18" />
            <line x1="6" y1="6" x2="18" y2="18" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button class="btn-cancel" (click)="closeUploadModal()">Cancelar</button>
      <button
        class="btn-submit"
        (click)="submitExercise()"
        [disabled]="!selectedFile || isSubmitting"
      >
        {{
          isSubmitting
            ? "‚è≥ Guardando..."
            : isEditMode
            ? "üíæ Guardar Cambios"
            : "üì§ Subir Entrega"
        }}
      </button>
    </div>
  </div>
</div>

<!-- Modal: Confirmaci√≥n Eliminar Entrega -->
<app-confirmation-modal
  *ngIf="showDeleteModal && exerciseToDelete"
  title="¬øEliminar entrega?"
  [message]="getDeleteSubmissionMessage()"
  confirmText="Eliminar"
  cancelText="Cancelar"
  type="danger"
  (confirm)="confirmDeleteSubmission()"
  (cancel)="cancelDeleteSubmission()"
>
</app-confirmation-modal>
