<div class="modal-overlay" (click)="closeModal()">
  <div class="modal-container" (click)="$event.stopPropagation()">
    <!-- Header -->
    <div class="modal-header">
      <div class="header-icon">
        <svg
          width="28"
          height="28"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
          ></path>
        </svg>
      </div>
      <div class="header-text">
        <h3>ðŸ’¬ Gestionar Grupo de WhatsApp</h3>
        <p>Comparte el enlace del grupo con tus estudiantes</p>
      </div>
      <button class="close-btn" (click)="closeModal()" aria-label="Cerrar">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <!-- Estado Actual -->
      <div class="current-status" [class.has-link]="currentLink">
        <div class="status-icon">
          <svg
            *ngIf="!currentLink"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="15" y1="9" x2="9" y2="15"></line>
            <line x1="9" y1="9" x2="15" y2="15"></line>
          </svg>
          <svg
            *ngIf="currentLink"
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
        </div>
        <div class="status-text">
          <strong>Estado actual:</strong>
          <span *ngIf="!currentLink">Sin enlace configurado</span>
          <span *ngIf="currentLink" class="link-preview">{{
            currentLink
          }}</span>
        </div>
      </div>

      <!-- Input de URL -->
      <div class="input-group">
        <label for="whatsapp-link"> ðŸ”— Enlace del grupo de WhatsApp </label>
        <input
          type="url"
          id="whatsapp-link"
          [(ngModel)]="whatsappLink"
          placeholder="https://chat.whatsapp.com/ABC123xyz"
          class="input-field"
          [class.error]="showError"
        />
        <span class="input-hint" *ngIf="!showError">
          Pega aquÃ­ el enlace de invitaciÃ³n del grupo
        </span>
        <span class="input-error" *ngIf="showError">
          {{ errorMessage }}
        </span>
      </div>

      <!-- Instrucciones -->
      <div class="instructions">
        <div class="instruction-header">
          <svg
            width="18"
            height="18"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="16" x2="12" y2="12"></line>
            <line x1="12" y1="8" x2="12.01" y2="8"></line>
          </svg>
          <strong>Â¿CÃ³mo obtener el enlace?</strong>
        </div>
        <ol class="instruction-list">
          <li>Abre WhatsApp y ve al grupo del curso</li>
          <li>Toca en el nombre del grupo (arriba)</li>
          <li>Toca "Invitar mediante enlace"</li>
          <li>Copia el enlace y pÃ©galo aquÃ­</li>
        </ol>
      </div>

      <!-- Preview del enlace -->
      <div
        class="link-preview-box"
        *ngIf="whatsappLink && isValidUrl(whatsappLink)"
      >
        <div class="preview-icon">
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"
            ></path>
          </svg>
        </div>
        <div class="preview-text">
          <strong>âœ… Enlace vÃ¡lido</strong>
          <p>Los estudiantes podrÃ¡n unirse al grupo</p>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <div class="modal-footer">
      <button
        *ngIf="currentLink"
        class="btn-danger"
        (click)="deleteLink()"
        [disabled]="isSubmitting"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="3 6 5 6 21 6"></polyline>
          <path
            d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
          ></path>
        </svg>
        Eliminar Enlace
      </button>

      <button class="btn-cancel" (click)="closeModal()">Cancelar</button>

      <button
        class="btn-submit"
        (click)="saveLink()"
        [disabled]="!whatsappLink || !isValidUrl(whatsappLink) || isSubmitting"
      >
        <svg
          width="18"
          height="18"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <polyline points="20 6 9 17 4 12"></polyline>
        </svg>
        {{ isSubmitting ? "Guardando..." : "Guardar Enlace" }}
      </button>
    </div>
  </div>
</div>
