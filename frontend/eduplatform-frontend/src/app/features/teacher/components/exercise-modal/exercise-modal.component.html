<div class="modal-overlay" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <!-- Header -->
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            />
            <polyline points="14 2 14 8 20 8" />
          </svg>
        </div>
        <div>
          <h2 class="modal-title">
            {{ editingExercise ? "‚úèÔ∏è Editar Ejercicio" : "üìù Crear Ejercicio" }}
          </h2>
          <p class="modal-subtitle">
            {{
              editingExercise
                ? "Actualiza la informaci√≥n del ejercicio"
                : "Agrega un nuevo ejercicio al curso"
            }}
          </p>
        </div>
      </div>
      <button class="close-btn" (click)="close()">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <!-- Form -->
    <form (ngSubmit)="onSubmit()" class="modal-form">
      <!-- T√≠tulo -->
      <div class="form-group">
        <label for="title">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" />
            <path
              d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"
            />
          </svg>
          T√≠tulo del Ejercicio
          <span class="required">*</span>
        </label>
        <input
          type="text"
          id="title"
          class="form-input"
          [(ngModel)]="exerciseForm.title"
          name="title"
          placeholder="Ej: Ejercicio de Estructuras de Control"
          required
          maxlength="100"
        />
      </div>

      <!-- Descripci√≥n -->
      <div class="form-group">
        <label for="description">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            />
            <polyline points="14 2 14 8 20 8" />
            <line x1="16" y1="13" x2="8" y2="13" />
            <line x1="16" y1="17" x2="8" y2="17" />
          </svg>
          Descripci√≥n
          <span class="required">*</span>
        </label>
        <textarea
          id="description"
          class="form-textarea"
          [(ngModel)]="exerciseForm.description"
          name="description"
          placeholder="Describe las instrucciones y objetivos del ejercicio..."
          rows="5"
          required
          maxlength="1000"
        ></textarea>
        <div class="char-count">
          <span [class.char-limit]="exerciseForm.description.length > 900">
            {{ exerciseForm.description.length }}/1000
          </span>
          caracteres
        </div>
      </div>

      <!-- Dificultad -->
      <div class="form-group">
        <label for="difficulty">
          Dificultad <span class="required">*</span>
        </label>
        <select
          id="difficulty"
          class="form-select"
          [(ngModel)]="exerciseForm.difficulty"
          name="difficulty"
          required
        >
          <option value="">Seleccionar</option>
          <option value="Principiante">üå± Principiante</option>
          <option value="Intermedio">üéØ Intermedio</option>
          <option value="Avanzado">üöÄ Avanzado</option>
          <option value="Experto">‚≠ê Experto</option>
        </select>
      </div>

      <!-- Fecha L√≠mite -->
      <div class="form-group">
        <label for="deadline">
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
            <line x1="16" y1="2" x2="16" y2="6" />
            <line x1="8" y1="2" x2="8" y2="6" />
            <line x1="3" y1="10" x2="21" y2="10" />
          </svg>
          Fecha L√≠mite (Opcional)
        </label>
        <input
          type="datetime-local"
          id="deadline"
          class="form-input"
          [(ngModel)]="exerciseForm.deadline"
          name="deadline"
        />
      </div>

      <!-- Archivo -->
      <div class="form-group">
        <label>
          <svg
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="17 8 12 3 7 8" />
            <line x1="12" y1="3" x2="12" y2="15" />
          </svg>
          Archivo del Ejercicio {{ editingExercise ? "(Opcional)" : "" }}
        </label>

        <div
          class="file-upload-area"
          *ngIf="!selectedFile && !editingExercise?.fileName"
        >
          <input
            type="file"
            id="exercise-file"
            class="file-input"
            (change)="onFileSelected($event)"
            accept=".pdf,.zip,.rar,.txt,.doc,.docx"
          />
          <label for="exercise-file" class="file-label">
            <svg
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="17 8 12 3 7 8" />
              <line x1="12" y1="3" x2="12" y2="15" />
            </svg>
            <span>Haz clic para seleccionar archivo</span>
            <span class="file-hint">PDF, ZIP, documentos (m√°x. 10MB)</span>
          </label>
        </div>

        <div
          class="file-selected"
          *ngIf="selectedFile || editingExercise?.fileName"
        >
          <div class="file-info">
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path
                d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"
              />
              <polyline points="13 2 13 9 20 9" />
            </svg>
            <span>{{ selectedFile?.name || editingExercise?.fileName }}</span>
          </div>
          <button type="button" class="remove-file-btn" (click)="removeFile()">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <line x1="18" y1="6" x2="6" y2="18" />
              <line x1="6" y1="6" x2="18" y2="18" />
            </svg>
          </button>
        </div>
      </div>

      <!-- Info Box -->
      <div class="info-box">
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <circle cx="12" cy="12" r="10" />
          <line x1="12" y1="16" x2="12" y2="12" />
          <line x1="12" y1="8" x2="12.01" y2="8" />
        </svg>
        <div>
          <strong>Tip:</strong> Despu√©s de crear el ejercicio, podr√°s agregar
          pistas para ayudar a los estudiantes.
        </div>
      </div>

      <!-- Actions -->
      <div class="form-actions">
        <button type="button" class="cancel-btn" (click)="close()">
          Cancelar
        </button>
        <button
          type="submit"
          class="submit-btn"
          [disabled]="!isFormValid() || isSubmitting"
        >
          <svg
            width="20"
            height="20"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"
            />
            <polyline points="17 21 17 13 7 13 7 21" />
            <polyline points="7 3 7 8 15 8" />
          </svg>
          {{
            isSubmitting
              ? "‚è≥ Guardando..."
              : editingExercise
              ? "üíæ Guardar Cambios"
              : "üöÄ Crear Ejercicio"
          }}
        </button>
      </div>
    </form>
  </div>
</div>
