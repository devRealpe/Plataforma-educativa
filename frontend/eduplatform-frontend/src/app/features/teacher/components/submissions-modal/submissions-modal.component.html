<div class="modal-overlay" (click)="onBackdropClick($event)">
  <div class="modal-container">
    <!-- Header -->
    <div class="modal-header">
      <div class="header-content">
        <div class="header-icon">
          <svg
            width="32"
            height="32"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path
              d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
            />
            <polyline points="14 2 14 8 20 8" />
          </svg>
        </div>
        <div>
          <h2 class="modal-title">📋 Entregas del Ejercicio</h2>
          <p class="modal-subtitle">{{ exerciseTitle }}</p>
        </div>
      </div>
      <button class="close-btn" (click)="close()">
        <svg
          width="24"
          height="24"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <line x1="18" y1="6" x2="6" y2="18" />
          <line x1="6" y1="6" x2="18" y2="18" />
        </svg>
      </button>
    </div>

    <!-- Content -->
    <div class="modal-content">
      <!-- Stats -->
      <div class="stats-row">
        <div class="stat-item">
          <span class="stat-value">{{ submissions.length }}</span>
          <span class="stat-label">Total Entregas</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ getPendingCount() }}</span>
          <span class="stat-label">Pendientes</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ getGradedCount() }}</span>
          <span class="stat-label">Calificadas</span>
        </div>
        <div class="stat-item">
          <span class="stat-value">{{ getAverageGrade() }}</span>
          <span class="stat-label">Promedio</span>
        </div>
      </div>

      <!-- Loading -->
      <div *ngIf="isLoading" class="loading">
        <div class="spinner"></div>
        <p>Cargando entregas...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!isLoading && submissions.length === 0" class="empty-state">
        <svg
          width="80"
          height="80"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="1.5"
        >
          <path
            d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"
          />
          <polyline points="14 2 14 8 20 8" />
        </svg>
        <h3>No hay entregas todavía</h3>
        <p>
          Los estudiantes aún no han subido sus soluciones para este ejercicio
        </p>
      </div>

      <!-- Submissions List -->
      <div
        *ngIf="!isLoading && submissions.length > 0"
        class="submissions-list"
      >
        <div *ngFor="let submission of submissions" class="submission-card">
          <!-- Student Info -->
          <div class="submission-header">
            <div class="student-info">
              <div class="student-avatar">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
              </div>
              <div>
                <h4 class="student-name">{{ submission.studentName }}</h4>
                <p class="student-email">{{ submission.studentEmail }}</p>
              </div>
            </div>
            <div class="submission-status" [ngClass]="submission.status">
              {{ getStatusText(submission.status) }}
            </div>
          </div>

          <!-- Submission Details -->
          <div class="submission-details">
            <div class="detail-item">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                <line x1="16" y1="2" x2="16" y2="6" />
                <line x1="8" y1="2" x2="8" y2="6" />
                <line x1="3" y1="10" x2="21" y2="10" />
              </svg>
              <span>{{ submission.submittedAt | date : "short" }}</span>
            </div>
            <div class="detail-item">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"
                />
                <polyline points="13 2 13 9 20 9" />
              </svg>
              <span>{{ submission.fileName }}</span>
            </div>
          </div>

          <!-- Grade Section -->
          <div class="grade-section" *ngIf="submission.status === 'GRADED'">
            <div class="grade-display">
              <span class="grade-label">Calificación:</span>
              <span
                class="grade-value"
                [class.high]="submission.grade! >= 3.0"
                [class.low]="submission.grade! < 3.0"
              >
                {{ submission.grade }}/5.0
              </span>
            </div>
            <div class="feedback-display" *ngIf="submission.feedback">
              <strong>Retroalimentación:</strong>
              <p>{{ submission.feedback }}</p>
            </div>
          </div>

          <!-- Grading Form -->
          <div
            class="grading-form"
            *ngIf="gradingSubmission?.id === submission.id"
          >
            <div class="form-group">
              <label>Calificación (0.0 - 5.0)</label>
              <input
                type="number"
                class="grade-input"
                [(ngModel)]="gradeForm.grade"
                min="0"
                max="5"
                step="0.1"
                placeholder="4.5"
              />
              <small class="input-hint">Ingresa una nota entre 0.0 y 5.0</small>
            </div>
            <div class="form-group">
              <label>Retroalimentación</label>
              <textarea
                class="feedback-textarea"
                [(ngModel)]="gradeForm.feedback"
                placeholder="Escribe tu retroalimentación para el estudiante..."
                rows="4"
              ></textarea>
            </div>
            <div class="form-actions">
              <button class="btn-cancel" (click)="cancelGrading()">
                Cancelar
              </button>
              <button
                class="btn-submit"
                (click)="submitGrade()"
                [disabled]="!isGradeValid()"
              >
                Guardar Calificación
              </button>
            </div>
          </div>

          <!-- Actions -->
          <div
            class="submission-actions"
            *ngIf="gradingSubmission?.id !== submission.id"
          >
            <button
              class="action-btn download"
              (click)="downloadSubmission(submission)"
            >
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                <polyline points="7 10 12 15 17 10" />
                <line x1="12" y1="15" x2="12" y2="3" />
              </svg>
              Descargar
            </button>
            <button class="action-btn grade" (click)="startGrading(submission)">
              <svg
                width="18"
                height="18"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
              >
                <path
                  d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                />
                <path
                  d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                />
              </svg>
              {{
                submission.status === "GRADED"
                  ? "Editar Calificación"
                  : "Calificar"
              }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
